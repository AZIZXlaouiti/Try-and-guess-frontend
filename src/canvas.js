import React, { useRef , useState } from 'react';
import { render } from 'react-dom';
import { Stage, Layer, Line, Text } from 'react-konva';

const Canvas = ({lines, setLines, handleSendCanvas}) => {
  const [tool, setTool] = useState('pen');
  
  const isDrawing = useRef(false);
  const lo = useRef([])
  const data = [
    {
        "tool": "pen",
        "points": [
            249,
            186.90625,
            250,
            188.90625,
            250,
            193.90625,
            251,
            201.90625,
            253,
            210.90625,
            253,
            220.90625,
            255,
            233.90625,
            258,
            245.90625,
            260,
            255.90625,
            264,
            265.90625,
            268,
            273.90625,
            271,
            279.90625,
            274,
            283.90625,
            278,
            285.90625,
            280,
            286.90625,
            284,
            287.90625,
            289,
            288.90625,
            295,
            288.90625,
            304,
            284.90625,
            314,
            280.90625,
            326,
            274.90625,
            339,
            265.90625,
            349,
            259.90625,
            358,
            255.90625,
            364,
            251.90625,
            368,
            249.90625,
            371,
            248.90625,
            373,
            247.90625,
            374,
            247.90625,
            376,
            247.90625
        ]
    },
    {
        "tool": "pen",
        "points": [
            277,
            259.90625,
            279,
            270.90625,
            282,
            282.90625,
            285,
            294.90625,
            288,
            306.90625,
            291,
            320.90625,
            293,
            331.90625,
            295,
            345.90625,
            298,
            354.90625,
            301,
            360.90625,
            304,
            364.90625,
            307,
            367.90625,
            312,
            368.90625,
            319,
            369.90625,
            327,
            369.90625,
            338,
            365.90625,
            350,
            360.90625,
            364,
            355.90625,
            379,
            348.90625,
            392,
            341.90625,
            402,
            335.90625,
            411,
            330.90625,
            418,
            327.90625,
            422,
            326.90625,
            425,
            325.90625,
            426,
            325.90625,
            427,
            325.90625,
            428,
            328.90625,
            430,
            333.90625,
            432,
            341.90625,
            435,
            349.90625,
            438,
            358.90625,
            441,
            367.90625,
            445,
            375.90625,
            449,
            382.90625,
            454,
            386.90625,
            460,
            391.90625,
            469,
            394.90625,
            484,
            395.90625,
            501,
            395.90625,
            518,
            392.90625,
            543,
            385.90625,
            570,
            377.90625,
            597,
            367.90625,
            624,
            358.90625,
            647,
            350.90625
        ]
    },
    {
        "tool": "pen",
        "points": [
            416,
            484.90625,
            415,
            484.90625,
            412,
            487.90625,
            405,
            496.90625,
            395,
            510.90625,
            381,
            530.90625,
            366,
            551.90625,
            353,
            570.90625,
            343,
            586.90625,
            338,
            596.90625,
            338,
            601.90625,
            338,
            602.90625,
            340,
            602.90625,
            349,
            602.90625,
            365,
            595.90625,
            396,
            581.90625,
            429,
            564.90625,
            480,
            540.90625,
            527,
            517.90625,
            558,
            503.90625,
            587,
            491.90625,
            597,
            488.90625,
            598,
            488.90625,
            598,
            489.90625,
            594,
            496.90625,
            588,
            513.90625,
            580,
            533.90625,
            577,
            548.90625,
            574,
            562.90625,
            573,
            574.90625,
            573,
            586.90625,
            574,
            594.90625,
            578,
            598.90625,
            583,
            601.90625,
            592,
            602.90625,
            607,
            600.90625,
            633,
            593.90625,
            669,
            580.90625,
            707,
            569.90625,
            756,
            557.90625,
            800,
            550.90625,
            826,
            548.90625,
            848,
            548.90625,
            855,
            550.90625,
            857,
            551.90625,
            857,
            553.90625,
            857,
            557.90625,
            853,
            564.90625,
            851,
            570.90625,
            848,
            576.90625,
            846,
            581.90625,
            845,
            586.90625,
            845,
            591.90625,
            845,
            596.90625,
            845,
            598.90625
        ]
    },
    {
        "tool": "pen",
        "points": [
            262,
            638.90625,
            262,
            641.90625,
            259,
            651.90625,
            255,
            662.90625,
            252,
            674.90625,
            248,
            690.90625,
            247,
            705.90625,
            247,
            715.90625,
            247,
            724.90625,
            252,
            728.90625,
            259,
            729.90625,
            272,
            729.90625,
            293,
            724.90625,
            321,
            714.90625,
            357,
            699.90625,
            396,
            685.90625,
            426,
            674.90625,
            457,
            666.90625,
            475,
            664.90625,
            483,
            663.90625,
            485,
            664.90625,
            483,
            670.90625,
            478,
            679.90625,
            473,
            689.90625,
            470,
            696.90625,
            468,
            702.90625,
            467,
            707.90625,
            467,
            712.90625,
            469,
            716.90625,
            472,
            719.90625,
            478,
            721.90625,
            488,
            722.90625,
            504,
            722.90625,
            526,
            719.90625,
            556,
            713.90625,
            581,
            707.90625,
            623,
            698.90625,
            661,
            692.90625,
            692,
            689.90625,
            716,
            689.90625,
            734,
            691.90625,
            741,
            695.90625,
            744,
            699.90625,
            745,
            702.90625,
            745,
            706.90625,
            745,
            711.90625,
            746,
            716.90625,
            747,
            718.90625,
            751,
            722.90625,
            757,
            727.90625,
            767,
            732.90625,
            786,
            738.90625,
            809,
            743.90625,
            844,
            747.90625,
            879,
            747.90625
        ]
    },
    {
        "tool": "pen",
        "points": [
            718,
            110.90625,
            715,
            113.90625,
            708,
            121.90625,
            698,
            136.90625,
            687,
            150.90625,
            674,
            170.90625,
            662,
            186.90625,
            656,
            196.90625,
            653,
            202.90625,
            652,
            204.90625,
            656,
            205.90625,
            667,
            205.90625,
            683,
            204.90625,
            704,
            200.90625,
            722,
            196.90625,
            741,
            193.90625,
            755,
            191.90625,
            761,
            190.90625,
            764,
            190.90625,
            764,
            194.90625,
            763,
            203.90625,
            760,
            215.90625,
            758,
            228.90625,
            758,
            241.90625,
            758,
            249.90625,
            760,
            256.90625,
            763,
            262.90625,
            767,
            268.90625,
            772,
            273.90625,
            777,
            276.90625,
            786,
            278.90625,
            799,
            280.90625,
            814,
            280.90625,
            835,
            280.90625,
            856,
            280.90625,
            873,
            280.90625,
            891,
            280.90625,
            907,
            283.90625,
            917,
            287.90625,
            924,
            293.90625,
            929,
            300.90625,
            932,
            306.90625,
            935,
            314.90625,
            938,
            326.90625,
            941,
            338.90625,
            946,
            353.90625,
            953,
            368.90625,
            961,
            383.90625,
            970,
            400.90625,
            980,
            418.90625,
            989,
            429.90625,
            1000,
            441.90625
        ]
    },
    {
        "tool": "pen",
        "points": [
            645,
            243.90625,
            645,
            246.90625,
            645,
            254.90625,
            645,
            263.90625,
            645,
            274.90625,
            645,
            282.90625,
            645,
            288.90625,
            645,
            294.90625,
            647,
            298.90625,
            649,
            300.90625,
            654,
            303.90625,
            661,
            306.90625,
            669,
            308.90625,
            683,
            309.90625,
            700,
            308.90625,
            718,
            306.90625,
            738,
            304.90625,
            752,
            304.90625,
            763,
            304.90625,
            769,
            304.90625,
            773,
            306.90625,
            773,
            308.90625,
            773,
            312.90625,
            773,
            320.90625,
            771,
            330.90625,
            769,
            343.90625,
            768,
            354.90625,
            767,
            362.90625,
            767,
            369.90625,
            767,
            375.90625,
            768,
            380.90625,
            772,
            385.90625,
            775,
            389.90625,
            782,
            394.90625,
            792,
            398.90625,
            803,
            401.90625,
            817,
            406.90625,
            832,
            412.90625,
            846,
            416.90625,
            862,
            422.90625,
            877,
            427.90625,
            886,
            433.90625,
            891,
            438.90625,
            892,
            443.90625,
            893,
            447.90625,
            893,
            453.90625,
            893,
            461.90625,
            893,
            468.90625,
            893,
            477.90625,
            895,
            487.90625,
            897,
            495.90625,
            902,
            507.90625,
            909,
            520.90625,
            916,
            530.90625,
            924,
            542.90625,
            936,
            553.90625,
            948,
            563.90625,
            964,
            573.90625,
            988,
            586.90625,
            1008,
            594.90625
        ]
    },
    {
        "tool": "pen",
        "points": [
            814,
            621.90625,
            813,
            621.90625,
            809,
            625.90625,
            804,
            632.90625,
            798,
            639.90625,
            793,
            647.90625,
            790,
            654.90625,
            789,
            658.90625,
            788,
            659.90625,
            788,
            660.90625,
            792,
            660.90625,
            799,
            660.90625,
            810,
            658.90625,
            822,
            655.90625,
            834,
            651.90625,
            846,
            649.90625,
            858,
            646.90625,
            871,
            644.90625,
            877,
            644.90625,
            882,
            645.90625,
            883,
            646.90625,
            884,
            648.90625,
            885,
            653.90625,
            885,
            658.90625,
            885,
            665.90625,
            886,
            671.90625,
            888,
            676.90625,
            891,
            680.90625,
            894,
            682.90625,
            899,
            686.90625,
            904,
            688.90625,
            913,
            691.90625,
            927,
            692.90625,
            946,
            692.90625,
            967,
            693.90625,
            989,
            693.90625,
            1006,
            693.90625,
            1022,
            692.90625,
            1034,
            692.90625,
            1039,
            694.90625,
            1040,
            695.90625,
            1042,
            698.90625,
            1042,
            703.90625,
            1043,
            708.90625,
            1045,
            715.90625,
            1046,
            718.90625,
            1049,
            723.90625,
            1052,
            727.90625
        ]
    },
    {
        "tool": "pen",
        "points": [
            675,
            413.90625,
            674,
            414.90625,
            671,
            417.90625,
            668,
            422.90625,
            664,
            428.90625,
            660,
            436.90625,
            658,
            443.90625,
            656,
            450.90625,
            655,
            456.90625,
            655,
            459.90625,
            656,
            460.90625,
            657,
            460.90625,
            660,
            461.90625,
            665,
            462.90625,
            671,
            462.90625,
            677,
            462.90625,
            683,
            462.90625,
            688,
            460.90625,
            693,
            459.90625,
            695,
            459.90625,
            695,
            463.90625,
            695,
            469.90625,
            695,
            475.90625,
            695,
            482.90625,
            695,
            487.90625,
            695,
            490.90625,
            696,
            492.90625,
            697,
            494.90625,
            699,
            495.90625,
            702,
            496.90625,
            706,
            499.90625,
            711,
            500.90625,
            718,
            502.90625,
            727,
            502.90625,
            739,
            502.90625,
            754,
            502.90625,
            766,
            502.90625,
            778,
            502.90625,
            786,
            503.90625,
            789,
            504.90625,
            791,
            505.90625,
            792,
            506.90625,
            793,
            508.90625,
            794,
            510.90625,
            795,
            512.90625,
            796,
            514.90625,
            796,
            516.90625,
            797,
            517.90625,
            798,
            519.90625,
            799,
            521.90625,
            801,
            523.90625,
            804,
            527.90625
        ]
    }
]
  const handleMouseDown = (e) => {
    isDrawing.current = true;
    let pos = e.target.getStage().getPointerPosition();
    setLines([...lines, { tool, points: [pos.x, pos.y] }]);
    console.log('down')
    // lo.current = lines
  };
  
  const handleMouseMove = (e) => {
    // no drawing - skipping
    if (!isDrawing.current) {
      return;
    }
    let stage = e.target.getStage();
    let point = stage.getPointerPosition();
    let lastLine = lines[lines.length - 1];
    // add point
    lastLine.points = lastLine.points.concat([point.x, point.y]);

    // replace last
    lines.splice(lines.length - 1, 1, lastLine);
    setLines(lines.concat());
    // lo.current = lines
    handleSendCanvas(lines)
  };

  const handleMouseUp = () => {
    isDrawing.current = false;
  };
  console.log(lines,'lines')
  return (
    <div>
      <Stage
        width={window.innerWidth}
        height={window.innerHeight}
        onMouseDown={handleMouseDown}
        onMousemove={handleMouseMove}
        onMouseup={handleMouseUp}
       
      >
        <Layer>
          <Text text="Just start drawing" x={5} y={30} />
          {lines.map((line, i) => (
            <Line
           
              key={i}
              points={line.points}
              stroke="blue"
              strokeWidth={10}
              tension={0.5}
              lineCap="round"
              globalCompositeOperation={
                line.tool === 'eraser' ? 'destination-out' : 'source-over'
              }
            />
          ))}
        </Layer>
      </Stage>
      <select
        value={tool}
        onChange={(e) => {
          setTool(e.target.value);
        }}
      >
        <option value="pen">Pen</option>
        <option value="eraser">Eraser</option>
      </select>
      <button onClick={(e)=>setLines(data)}>load</button>
      
    </div>
  );
};
export default  Canvas

